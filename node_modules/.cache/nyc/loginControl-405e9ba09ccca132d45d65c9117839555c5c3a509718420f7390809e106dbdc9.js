function cov_17w085kluc(){var path="/Users/salvatore/Desktop/EasyAgreement-IGES/app/controllers/loginControl.js";var hash="2f09f6ba56732c2a5aa098340d505fd484a0e097";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/salvatore/Desktop/EasyAgreement-IGES/app/controllers/loginControl.js",statementMap:{"0":{start:{line:1,column:11},end:{line:1,column:31}},"1":{start:{line:2,column:19},end:{line:2,column:50}},"2":{start:{line:3,column:25},end:{line:3,column:62}},"3":{start:{line:4,column:25},end:{line:4,column:62}},"4":{start:{line:5,column:25},end:{line:5,column:62}},"5":{start:{line:6,column:22},end:{line:6,column:61}},"6":{start:{line:13,column:0},end:{line:139,column:1}},"7":{start:{line:14,column:2},end:{line:138,column:4}},"8":{start:{line:16,column:19},end:{line:16,column:36}},"9":{start:{line:17,column:19},end:{line:17,column:36}},"10":{start:{line:20,column:18},end:{line:20,column:22}},"11":{start:{line:21,column:4},end:{line:28,column:5}},"12":{start:{line:22,column:6},end:{line:27,column:7}},"13":{start:{line:23,column:8},end:{line:26,column:9}},"14":{start:{line:24,column:10},end:{line:24,column:40}},"15":{start:{line:25,column:10},end:{line:25,column:25}},"16":{start:{line:30,column:4},end:{line:33,column:5}},"17":{start:{line:31,column:6},end:{line:31,column:36}},"18":{start:{line:32,column:6},end:{line:32,column:21}},"19":{start:{line:35,column:4},end:{line:38,column:5}},"20":{start:{line:36,column:6},end:{line:36,column:20}},"21":{start:{line:37,column:6},end:{line:37,column:12}},"22":{start:{line:40,column:23},end:{line:40,column:57}},"23":{start:{line:51,column:4},end:{line:137,column:6}},"24":{start:{line:52,column:6},end:{line:136,column:7}},"25":{start:{line:53,column:28},end:{line:53,column:72}},"26":{start:{line:54,column:8},end:{line:123,column:10}},"27":{start:{line:55,column:10},end:{line:122,column:11}},"28":{start:{line:56,column:32},end:{line:56,column:72}},"29":{start:{line:57,column:12},end:{line:109,column:14}},"30":{start:{line:58,column:14},end:{line:108,column:15}},"31":{start:{line:59,column:33},end:{line:59,column:73}},"32":{start:{line:60,column:16},end:{line:95,column:18}},"33":{start:{line:61,column:18},end:{line:94,column:19}},"34":{start:{line:62,column:42},end:{line:62,column:79}},"35":{start:{line:63,column:20},end:{line:80,column:18}},"36":{start:{line:64,column:18},end:{line:79,column:19}},"37":{start:{line:65,column:20},end:{line:65,column:47}},"38":{start:{line:66,column:20},end:{line:66,column:34}},"39":{start:{line:68,column:20},end:{line:78,column:21}},"40":{start:{line:69,column:46},end:{line:72,column:23}},"41":{start:{line:73,column:22},end:{line:73,column:47}},"42":{start:{line:74,column:22},end:{line:74,column:48}},"43":{start:{line:76,column:22},end:{line:76,column:49}},"44":{start:{line:77,column:22},end:{line:77,column:36}},"45":{start:{line:82,column:20},end:{line:93,column:21}},"46":{start:{line:83,column:41},end:{line:87,column:23}},"47":{start:{line:88,column:22},end:{line:88,column:47}},"48":{start:{line:89,column:22},end:{line:89,column:43}},"49":{start:{line:91,column:22},end:{line:91,column:49}},"50":{start:{line:92,column:22},end:{line:92,column:36}},"51":{start:{line:97,column:16},end:{line:107,column:17}},"52":{start:{line:98,column:40},end:{line:101,column:19}},"53":{start:{line:102,column:18},end:{line:102,column:43}},"54":{start:{line:103,column:18},end:{line:103,column:42}},"55":{start:{line:105,column:18},end:{line:105,column:45}},"56":{start:{line:106,column:18},end:{line:106,column:32}},"57":{start:{line:111,column:12},end:{line:121,column:13}},"58":{start:{line:112,column:36},end:{line:115,column:15}},"59":{start:{line:116,column:14},end:{line:116,column:39}},"60":{start:{line:117,column:14},end:{line:117,column:38}},"61":{start:{line:119,column:14},end:{line:119,column:41}},"62":{start:{line:120,column:14},end:{line:120,column:28}},"63":{start:{line:125,column:8},end:{line:135,column:9}},"64":{start:{line:126,column:31},end:{line:129,column:11}},"65":{start:{line:130,column:10},end:{line:130,column:35}},"66":{start:{line:131,column:10},end:{line:131,column:33}},"67":{start:{line:133,column:10},end:{line:133,column:37}},"68":{start:{line:134,column:10},end:{line:134,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:16},end:{line:13,column:17}},loc:{start:{line:13,column:36},end:{line:139,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:21},end:{line:14,column:22}},loc:{start:{line:14,column:48},end:{line:138,column:3}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:51,column:22},end:{line:51,column:23}},loc:{start:{line:51,column:41},end:{line:137,column:5}},line:51},"3":{name:"(anonymous_3)",decl:{start:{line:54,column:27},end:{line:54,column:28}},loc:{start:{line:54,column:46},end:{line:123,column:9}},line:54},"4":{name:"(anonymous_4)",decl:{start:{line:57,column:31},end:{line:57,column:32}},loc:{start:{line:57,column:50},end:{line:109,column:13}},line:57},"5":{name:"(anonymous_5)",decl:{start:{line:60,column:32},end:{line:60,column:33}},loc:{start:{line:60,column:52},end:{line:95,column:17}},line:60},"6":{name:"(anonymous_6)",decl:{start:{line:63,column:41},end:{line:63,column:42}},loc:{start:{line:63,column:63},end:{line:80,column:17}},line:63}},branchMap:{"0":{loc:{start:{line:21,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:21,column:4},end:{line:28,column:5}},{start:{line:21,column:4},end:{line:28,column:5}}],line:21},"1":{loc:{start:{line:21,column:8},end:{line:21,column:113}},type:"binary-expr",locations:[{start:{line:21,column:9},end:{line:21,column:25}},{start:{line:21,column:31},end:{line:21,column:51}},{start:{line:21,column:57},end:{line:21,column:112}}],line:21},"2":{loc:{start:{line:22,column:6},end:{line:27,column:7}},type:"if",locations:[{start:{line:22,column:6},end:{line:27,column:7}},{start:{line:22,column:6},end:{line:27,column:7}}],line:22},"3":{loc:{start:{line:23,column:8},end:{line:26,column:9}},type:"if",locations:[{start:{line:23,column:8},end:{line:26,column:9}},{start:{line:23,column:8},end:{line:26,column:9}}],line:23},"4":{loc:{start:{line:30,column:4},end:{line:33,column:5}},type:"if",locations:[{start:{line:30,column:4},end:{line:33,column:5}},{start:{line:30,column:4},end:{line:33,column:5}}],line:30},"5":{loc:{start:{line:30,column:8},end:{line:30,column:104}},type:"binary-expr",locations:[{start:{line:30,column:9},end:{line:30,column:25}},{start:{line:30,column:31},end:{line:30,column:51}},{start:{line:30,column:57},end:{line:30,column:103}}],line:30},"6":{loc:{start:{line:35,column:4},end:{line:38,column:5}},type:"if",locations:[{start:{line:35,column:4},end:{line:38,column:5}},{start:{line:35,column:4},end:{line:38,column:5}}],line:35},"7":{loc:{start:{line:52,column:6},end:{line:136,column:7}},type:"if",locations:[{start:{line:52,column:6},end:{line:136,column:7}},{start:{line:52,column:6},end:{line:136,column:7}}],line:52},"8":{loc:{start:{line:55,column:10},end:{line:122,column:11}},type:"if",locations:[{start:{line:55,column:10},end:{line:122,column:11}},{start:{line:55,column:10},end:{line:122,column:11}}],line:55},"9":{loc:{start:{line:58,column:14},end:{line:108,column:15}},type:"if",locations:[{start:{line:58,column:14},end:{line:108,column:15}},{start:{line:58,column:14},end:{line:108,column:15}}],line:58},"10":{loc:{start:{line:61,column:18},end:{line:94,column:19}},type:"if",locations:[{start:{line:61,column:18},end:{line:94,column:19}},{start:{line:61,column:18},end:{line:94,column:19}}],line:61},"11":{loc:{start:{line:64,column:18},end:{line:79,column:19}},type:"if",locations:[{start:{line:64,column:18},end:{line:79,column:19}},{start:{line:64,column:18},end:{line:79,column:19}}],line:64},"12":{loc:{start:{line:68,column:20},end:{line:78,column:21}},type:"if",locations:[{start:{line:68,column:20},end:{line:78,column:21}},{start:{line:68,column:20},end:{line:78,column:21}}],line:68},"13":{loc:{start:{line:82,column:20},end:{line:93,column:21}},type:"if",locations:[{start:{line:82,column:20},end:{line:93,column:21}},{start:{line:82,column:20},end:{line:93,column:21}}],line:82},"14":{loc:{start:{line:97,column:16},end:{line:107,column:17}},type:"if",locations:[{start:{line:97,column:16},end:{line:107,column:17}},{start:{line:97,column:16},end:{line:107,column:17}}],line:97},"15":{loc:{start:{line:111,column:12},end:{line:121,column:13}},type:"if",locations:[{start:{line:111,column:12},end:{line:121,column:13}},{start:{line:111,column:12},end:{line:121,column:13}}],line:111},"16":{loc:{start:{line:125,column:8},end:{line:135,column:9}},type:"if",locations:[{start:{line:125,column:8},end:{line:135,column:9}},{start:{line:125,column:8},end:{line:135,column:9}}],line:125}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2f09f6ba56732c2a5aa098340d505fd484a0e097"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_17w085kluc=function(){return actualCoverage;};}return actualCoverage;}cov_17w085kluc();var hash=(cov_17w085kluc().s[0]++,require('./hash.js'));var studentModel=(cov_17w085kluc().s[1]++,require('../models/student.js'));var academicTutorModel=(cov_17w085kluc().s[2]++,require('../models/academicTutor.js'));var externalTutorModel=(cov_17w085kluc().s[3]++,require('../models/externaltutor.js'));var administratorModel=(cov_17w085kluc().s[4]++,require('../models/administrator.js'));var commissionModel=(cov_17w085kluc().s[5]++,require('../models/commisioneInter.js'));/**
 * This method authenticates the user to the system
 * @param {Object} req - The HTTP request
 * @param {Object} res - The HTTP response
 * @returns {Boolean}  - It returns true if login was successfull, else false
 */cov_17w085kluc().s[6]++;exports.login=function(req,res){cov_17w085kluc().f[0]++;cov_17w085kluc().s[7]++;return new Promise(function(resolve,reject){cov_17w085kluc().f[1]++;// take form parameters
var username=(cov_17w085kluc().s[8]++,req.body.username);var password=(cov_17w085kluc().s[9]++,req.body.password);// form validation
var isRight=(cov_17w085kluc().s[10]++,true);cov_17w085kluc().s[11]++;if((cov_17w085kluc().b[1][0]++,username==null)||(cov_17w085kluc().b[1][1]++,username.length<=1)||(cov_17w085kluc().b[1][2]++,!/^[a-z].[a-z]+[1-9]*@studenti.unisa.it/.test(username))){cov_17w085kluc().b[0][0]++;cov_17w085kluc().s[12]++;if(!/^[a-z].[a-z]+[1-9]*@unisa.it/.test(username)){cov_17w085kluc().b[2][0]++;cov_17w085kluc().s[13]++;if(!/[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9]){1,}?/.test(username)){cov_17w085kluc().b[3][0]++;cov_17w085kluc().s[14]++;res.cookie('errUsername','1');cov_17w085kluc().s[15]++;isRight=false;}else{cov_17w085kluc().b[3][1]++;}}else{cov_17w085kluc().b[2][1]++;}}else{cov_17w085kluc().b[0][1]++;}cov_17w085kluc().s[16]++;if((cov_17w085kluc().b[5][0]++,password==null)||(cov_17w085kluc().b[5][1]++,password.length<=7)||(cov_17w085kluc().b[5][2]++,!new RegExp('^[A-Za-z0-9\s]+$').test(password))){cov_17w085kluc().b[4][0]++;cov_17w085kluc().s[17]++;res.cookie('errPassword','1');cov_17w085kluc().s[18]++;isRight=false;}else{cov_17w085kluc().b[4][1]++;}cov_17w085kluc().s[19]++;if(!isRight){cov_17w085kluc().b[6][0]++;cov_17w085kluc().s[20]++;resolve(false);cov_17w085kluc().s[21]++;return;}else{cov_17w085kluc().b[6][1]++;}var checkStudent=(cov_17w085kluc().s[22]++,studentModel.findByEmail(username));/**
          * Check the student's email with the emails in the database. If the email is not founded generete a cookie error, else
          * check the password
          * @param {result} resultS - The result of the findByEmail function (about student)
          * @param {result} resultA - The result of the findByEmail function (about academic tutor)
          * @param {result} resultE - The result of the findByEmail function (about external tutor)
          * @param {result} resultAd- The result of the findByEmail function (about administrator)
          * @param {result} resultComm- The result of the findByEmail function (about commission)
          */cov_17w085kluc().s[23]++;checkStudent.then(function(resultS){cov_17w085kluc().f[2]++;cov_17w085kluc().s[24]++;if(resultS==null){cov_17w085kluc().b[7][0]++;var checkAcademic=(cov_17w085kluc().s[25]++,academicTutorModel.RetrieveByEmail(username));cov_17w085kluc().s[26]++;checkAcademic.then(function(resultA){cov_17w085kluc().f[3]++;cov_17w085kluc().s[27]++;if(resultA==null){cov_17w085kluc().b[8][0]++;var checkExternal=(cov_17w085kluc().s[28]++,externalTutorModel.findByEmail(username));cov_17w085kluc().s[29]++;checkExternal.then(function(resultE){cov_17w085kluc().f[4]++;cov_17w085kluc().s[30]++;if(resultE==null){cov_17w085kluc().b[9][0]++;var checkAdmin=(cov_17w085kluc().s[31]++,administratorModel.findByEmail(username));cov_17w085kluc().s[32]++;checkAdmin.then(function(resultAd){cov_17w085kluc().f[5]++;cov_17w085kluc().s[33]++;if(resultAd==null){cov_17w085kluc().b[10][0]++;var checkCommission=(cov_17w085kluc().s[34]++,commissionModel.findByEmail(username));cov_17w085kluc().s[35]++;checkCommission.then(function(resultComm){cov_17w085kluc().f[6]++;cov_17w085kluc().s[36]++;if(resultComm==null){cov_17w085kluc().b[11][0]++;cov_17w085kluc().s[37]++;res.cookie('errLogin','1');cov_17w085kluc().s[38]++;resolve(false);}else{cov_17w085kluc().b[11][1]++;cov_17w085kluc().s[39]++;if(hash.checkPassword(resultComm.getPassword().hash,resultComm.getPassword().salt,password)){cov_17w085kluc().b[12][0]++;var commissionSession=(cov_17w085kluc().s[40]++,{utente:resultComm,type:'commission'});cov_17w085kluc().s[41]++;res.cookie('logEff','1');cov_17w085kluc().s[42]++;resolve(commissionSession);}else{cov_17w085kluc().b[12][1]++;cov_17w085kluc().s[43]++;res.cookie('errLogin','1');cov_17w085kluc().s[44]++;resolve(false);}}});}else{cov_17w085kluc().b[10][1]++;cov_17w085kluc().s[45]++;if(hash.checkPassword(resultAd.getPassword().hash,resultAd.getPassword().salt,password)){cov_17w085kluc().b[13][0]++;var adminSession=(cov_17w085kluc().s[46]++,{utente:resultAd,type:'admin'});cov_17w085kluc().s[47]++;res.cookie('logEff','1');cov_17w085kluc().s[48]++;resolve(adminSession);}else{cov_17w085kluc().b[13][1]++;cov_17w085kluc().s[49]++;res.cookie('errLogin','1');cov_17w085kluc().s[50]++;resolve(false);}}});}else{cov_17w085kluc().b[9][1]++;cov_17w085kluc().s[51]++;if(hash.checkPassword(resultE.getPassword().hash,resultE.getPassword().salt,password)){cov_17w085kluc().b[14][0]++;var externalSession=(cov_17w085kluc().s[52]++,{utente:resultE,type:'externalTutor'});cov_17w085kluc().s[53]++;res.cookie('logEff','1');cov_17w085kluc().s[54]++;resolve(externalSession);}else{cov_17w085kluc().b[14][1]++;cov_17w085kluc().s[55]++;res.cookie('errLogin','1');cov_17w085kluc().s[56]++;resolve(false);}}});}else{cov_17w085kluc().b[8][1]++;cov_17w085kluc().s[57]++;if(hash.checkPassword(resultA.getPassword().hash,resultA.getPassword().salt,password)){cov_17w085kluc().b[15][0]++;var academicSession=(cov_17w085kluc().s[58]++,{utente:resultA,type:'academicTutor'});cov_17w085kluc().s[59]++;res.cookie('logEff','1');cov_17w085kluc().s[60]++;resolve(academicSession);}else{cov_17w085kluc().b[15][1]++;cov_17w085kluc().s[61]++;res.cookie('errLogin','1');cov_17w085kluc().s[62]++;resolve(false);}}});}else{cov_17w085kluc().b[7][1]++;cov_17w085kluc().s[63]++;if(hash.checkPassword(resultS.getPassword().hash,resultS.getPassword().salt,password)){cov_17w085kluc().b[16][0]++;var studentSession=(cov_17w085kluc().s[64]++,{utente:resultS,type:'student'});cov_17w085kluc().s[65]++;res.cookie('logEff','1');cov_17w085kluc().s[66]++;resolve(studentSession);}else{cov_17w085kluc().b[16][1]++;cov_17w085kluc().s[67]++;res.cookie('errLogin','1');cov_17w085kluc().s[68]++;resolve(false);}}});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2luQ29udHJvbC5qcyJdLCJuYW1lcyI6WyJoYXNoIiwicmVxdWlyZSIsInN0dWRlbnRNb2RlbCIsImFjYWRlbWljVHV0b3JNb2RlbCIsImV4dGVybmFsVHV0b3JNb2RlbCIsImFkbWluaXN0cmF0b3JNb2RlbCIsImNvbW1pc3Npb25Nb2RlbCIsImV4cG9ydHMiLCJsb2dpbiIsInJlcSIsInJlcyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidXNlcm5hbWUiLCJib2R5IiwicGFzc3dvcmQiLCJpc1JpZ2h0IiwibGVuZ3RoIiwidGVzdCIsImNvb2tpZSIsIlJlZ0V4cCIsImNoZWNrU3R1ZGVudCIsImZpbmRCeUVtYWlsIiwidGhlbiIsInJlc3VsdFMiLCJjaGVja0FjYWRlbWljIiwiUmV0cmlldmVCeUVtYWlsIiwicmVzdWx0QSIsImNoZWNrRXh0ZXJuYWwiLCJyZXN1bHRFIiwiY2hlY2tBZG1pbiIsInJlc3VsdEFkIiwiY2hlY2tDb21taXNzaW9uIiwicmVzdWx0Q29tbSIsImNoZWNrUGFzc3dvcmQiLCJnZXRQYXNzd29yZCIsInNhbHQiLCJjb21taXNzaW9uU2Vzc2lvbiIsInV0ZW50ZSIsInR5cGUiLCJhZG1pblNlc3Npb24iLCJleHRlcm5hbFNlc3Npb24iLCJhY2FkZW1pY1Nlc3Npb24iLCJzdHVkZW50U2Vzc2lvbiJdLCJtYXBwaW5ncyI6ImtoVEFlWTsyRkFmWixHQUFJQSxDQUFBQSxJQUFJLDBCQUFHQyxPQUFPLENBQUMsV0FBRCxDQUFWLENBQVIsQ0FDQSxHQUFJQyxDQUFBQSxZQUFZLDBCQUFHRCxPQUFPLENBQUMsc0JBQUQsQ0FBVixDQUFoQixDQUNBLEdBQUlFLENBQUFBLGtCQUFrQiwwQkFBR0YsT0FBTyxDQUFDLDRCQUFELENBQVYsQ0FBdEIsQ0FDQSxHQUFJRyxDQUFBQSxrQkFBa0IsMEJBQUdILE9BQU8sQ0FBQyw0QkFBRCxDQUFWLENBQXRCLENBQ0EsR0FBSUksQ0FBQUEsa0JBQWtCLDBCQUFHSixPQUFPLENBQUMsNEJB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QUFxQixHQUFyQixFQUx3Rix5QkFNeEZSLE9BQU8sQ0FBQytCLGVBQUQsQ0FBUCxDQUNELENBUEQsSUFPTyxzREFDTGpDLEdBQUcsQ0FBQ1UsTUFBSixDQUFXLFVBQVgsQ0FBdUIsR0FBdkIsRUFESyx5QkFFTFIsT0FBTyxDQUFDLEtBQUQsQ0FBUCxDQUNELENBQ0YsQ0FDRixDQXJFRCxFQXNFRCxDQXhFRCxJQXdFTyxxREFDTCxHQUFJWixJQUFJLENBQUNtQyxhQUFMLENBQW1CVixPQUFPLENBQUNXLFdBQVIsR0FBc0JwQyxJQUF6QyxDQUErQ3lCLE9BQU8sQ0FBQ1csV0FBUixHQUFzQkMsSUFBckUsQ0FBMkVyQixRQUEzRSxDQUFKLENBQTBGLDZCQUN4RixHQUFJNEIsQ0FBQUEsY0FBYywyQkFBRyxDQUNuQkwsTUFBTSxDQUFFZCxPQURXLENBRW5CZSxJQUFJLENBQUUsU0FGYSxDQUFILENBQWxCLENBRHdGLHlCQUt4RjlCLEdBQUcsQ0FBQ1UsTUFBSixDQUFXLFFBQVgsQ0FBcUIsR0FBckIsRUFMd0YseUJBTXhGUixPQUFPLENBQUNnQyxjQUFELENBQVAsQ0FDRCxDQVBELElBT08sc0RBQ0xsQyxHQUFHLENBQUNVLE1BQUosQ0FBVyxVQUFYLENBQXVCLEdBQXZCLEVBREsseUJBRUxSLE9BQU8sQ0FBQyxLQUFELENBQVAsQ0FDRCxDQUNGLENBQ0YsQ0F0RkQsRUF1RkQsQ0E1SE0sQ0FBUCxDQTZIRCxDQTlIRCIsInNvdXJjZXNDb250ZW50IjpbInZhciBoYXNoID0gcmVxdWlyZSgnLi9oYXNoLmpzJylcbnZhciBzdHVkZW50TW9kZWwgPSByZXF1aXJlKCcuLi9tb2RlbHMvc3R1ZGVudC5qcycpXG52YXIgYWNhZGVtaWNUdXRvck1vZGVsID0gcmVxdWlyZSgnLi4vbW9kZWxzL2FjYWRlbWljVHV0b3IuanMnKVxudmFyIGV4dGVybmFsVHV0b3JNb2RlbCA9IHJlcXVpcmUoJy4uL21vZGVscy9leHRlcm5hbHR1dG9yLmpzJylcbnZhciBhZG1pbmlzdHJhdG9yTW9kZWwgPSByZXF1aXJlKCcuLi9tb2RlbHMvYWRtaW5pc3RyYXRvci5qcycpXG52YXIgY29tbWlzc2lvbk1vZGVsID0gcmVxdWlyZSgnLi4vbW9kZWxzL2NvbW1pc2lvbmVJbnRlci5qcycpXG4vKipcbiAqIFRoaXMgbWV0aG9kIGF1dGhlbnRpY2F0ZXMgdGhlIHVzZXIgdG8gdGhlIHN5c3RlbVxuICogQHBhcmFtIHtPYmplY3R9IHJlcSAtIFRoZSBIVFRQIHJlcXVlc3RcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXMgLSBUaGUgSFRUUCByZXNwb25zZVxuICogQHJldHVybnMge0Jvb2xlYW59ICAtIEl0IHJldHVybnMgdHJ1ZSBpZiBsb2dpbiB3YXMgc3VjY2Vzc2Z1bGwsIGVsc2UgZmFsc2VcbiAqL1xuZXhwb3J0cy5sb2dpbiA9IGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgIC8vIHRha2UgZm9ybSBwYXJhbWV0ZXJzXG4gICAgdmFyIHVzZXJuYW1lID0gcmVxLmJvZHkudXNlcm5hbWVcbiAgICB2YXIgcGFzc3dvcmQgPSByZXEuYm9keS5wYXNzd29yZFxuXG4gICAgLy8gZm9ybSB2YWxpZGF0aW9uXG4gICAgdmFyIGlzUmlnaHQgPSB0cnVlXG4gICAgaWYgKCh1c2VybmFtZSA9PSBudWxsKSB8fCAodXNlcm5hbWUubGVuZ3RoIDw9IDEpIHx8ICghL15bYS16XS5bYS16XStbMS05XSpAc3R1ZGVudGkudW5pc2EuaXQvLnRlc3QodXNlcm5hbWUpKSkge1xuICAgICAgaWYgKCEvXlthLXpdLlthLXpdK1sxLTldKkB1bmlzYS5pdC8udGVzdCh1c2VybmFtZSkpIHtcbiAgICAgICAgaWYgKCEvW2EtejAtOSEjJCUmJyorPT9eX2B7fH1+LV0rKD86XFwuW2EtejAtOSEjJCUmJyorPT9eX2B7fH1+LV0rKSpAKD86W2EtejAtOV0oPzpbYS16MC05LV0qW2EtejAtOV0pP1xcLikrW2EtejAtOV0oPzpbYS16MC05LV0qW2EtejAtOV0pezEsfT8vLnRlc3QodXNlcm5hbWUpKSB7XG4gICAgICAgICAgcmVzLmNvb2tpZSgnZXJyVXNlcm5hbWUnLCAnMScpXG4gICAgICAgICAgaXNSaWdodCA9IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoKHBhc3N3b3JkID09IG51bGwpIHx8IChwYXNzd29yZC5sZW5ndGggPD0gNykgfHwgKCFuZXcgUmVnRXhwKCdeW0EtWmEtejAtOVxcc10rJCcpLnRlc3QocGFzc3dvcmQpKSkge1xuICAgICAgcmVzLmNvb2tpZSgnZXJyUGFzc3dvcmQnLCAnMScpXG4gICAgICBpc1JpZ2h0ID0gZmFsc2VcbiAgICB9XG5cbiAgICBpZiAoIWlzUmlnaHQpIHtcbiAgICAgIHJlc29sdmUoZmFsc2UpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB2YXIgY2hlY2tTdHVkZW50ID0gc3R1ZGVudE1vZGVsLmZpbmRCeUVtYWlsKHVzZXJuYW1lKVxuXG4gICAgLyoqXG4gICAgICAgICAgKiBDaGVjayB0aGUgc3R1ZGVudCdzIGVtYWlsIHdpdGggdGhlIGVtYWlscyBpbiB0aGUgZGF0YWJhc2UuIElmIHRoZSBlbWFpbCBpcyBub3QgZm91bmRlZCBnZW5lcmV0ZSBhIGNvb2tpZSBlcnJvciwgZWxzZVxuICAgICAgICAgICogY2hlY2sgdGhlIHBhc3N3b3JkXG4gICAgICAgICAgKiBAcGFyYW0ge3Jlc3VsdH0gcmVzdWx0UyAtIFRoZSByZXN1bHQgb2YgdGhlIGZpbmRCeUVtYWlsIGZ1bmN0aW9uIChhYm91dCBzdHVkZW50KVxuICAgICAgICAgICogQHBhcmFtIHtyZXN1bHR9IHJlc3VsdEEgLSBUaGUgcmVzdWx0IG9mIHRoZSBmaW5kQnlFbWFpbCBmdW5jdGlvbiAoYWJvdXQgYWNhZGVtaWMgdHV0b3IpXG4gICAgICAgICAgKiBAcGFyYW0ge3Jlc3VsdH0gcmVzdWx0RSAtIFRoZSByZXN1bHQgb2YgdGhlIGZpbmRCeUVtYWlsIGZ1bmN0aW9uIChhYm91dCBleHRlcm5hbCB0dXRvcilcbiAgICAgICAgICAqIEBwYXJhbSB7cmVzdWx0fSByZXN1bHRBZC0gVGhlIHJlc3VsdCBvZiB0aGUgZmluZEJ5RW1haWwgZnVuY3Rpb24gKGFib3V0IGFkbWluaXN0cmF0b3IpXG4gICAgICAgICAgKiBAcGFyYW0ge3Jlc3VsdH0gcmVzdWx0Q29tbS0gVGhlIHJlc3VsdCBvZiB0aGUgZmluZEJ5RW1haWwgZnVuY3Rpb24gKGFib3V0IGNvbW1pc3Npb24pXG4gICAgICAgICAgKi9cbiAgICBjaGVja1N0dWRlbnQudGhlbihmdW5jdGlvbiAocmVzdWx0Uykge1xuICAgICAgaWYgKHJlc3VsdFMgPT0gbnVsbCkge1xuICAgICAgICB2YXIgY2hlY2tBY2FkZW1pYyA9IGFjYWRlbWljVHV0b3JNb2RlbC5SZXRyaWV2ZUJ5RW1haWwodXNlcm5hbWUpXG4gICAgICAgIGNoZWNrQWNhZGVtaWMudGhlbihmdW5jdGlvbiAocmVzdWx0QSkge1xuICAgICAgICAgIGlmIChyZXN1bHRBID09IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBjaGVja0V4dGVybmFsID0gZXh0ZXJuYWxUdXRvck1vZGVsLmZpbmRCeUVtYWlsKHVzZXJuYW1lKVxuICAgICAgICAgICAgY2hlY2tFeHRlcm5hbC50aGVuKGZ1bmN0aW9uIChyZXN1bHRFKSB7XG4gICAgICAgICAgICAgIGlmIChyZXN1bHRFID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tBZG1pbiA9IGFkbWluaXN0cmF0b3JNb2RlbC5maW5kQnlFbWFpbCh1c2VybmFtZSlcbiAgICAgICAgICAgICAgICBjaGVja0FkbWluLnRoZW4oZnVuY3Rpb24gKHJlc3VsdEFkKSB7XG4gICAgICAgICAgICAgICAgICBpZiAocmVzdWx0QWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2hlY2tDb21taXNzaW9uID0gY29tbWlzc2lvbk1vZGVsLmZpbmRCeUVtYWlsKHVzZXJuYW1lKVxuICAgICAgICAgICAgICAgICAgICBjaGVja0NvbW1pc3Npb24udGhlbihmdW5jdGlvbiAocmVzdWx0Q29tbSkge1xuICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdENvbW0gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXMuY29va2llKCdlcnJMb2dpbicsICcxJylcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSlcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoYXNoLmNoZWNrUGFzc3dvcmQocmVzdWx0Q29tbS5nZXRQYXNzd29yZCgpLmhhc2gsIHJlc3VsdENvbW0uZ2V0UGFzc3dvcmQoKS5zYWx0LCBwYXNzd29yZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tbWlzc2lvblNlc3Npb24gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGVudGU6IHJlc3VsdENvbW0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY29tbWlzc2lvbidcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgcmVzLmNvb2tpZSgnbG9nRWZmJywgJzEnKVxuICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY29tbWlzc2lvblNlc3Npb24pXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzLmNvb2tpZSgnZXJyTG9naW4nLCAnMScpXG4gICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2guY2hlY2tQYXNzd29yZChyZXN1bHRBZC5nZXRQYXNzd29yZCgpLmhhc2gsIHJlc3VsdEFkLmdldFBhc3N3b3JkKCkuc2FsdCwgcGFzc3dvcmQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGFkbWluU2Vzc2lvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZW50ZTogcmVzdWx0QWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYWRtaW4nXG5cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgcmVzLmNvb2tpZSgnbG9nRWZmJywgJzEnKVxuICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYWRtaW5TZXNzaW9uKVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIHJlcy5jb29raWUoJ2VyckxvZ2luJywgJzEnKVxuICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChoYXNoLmNoZWNrUGFzc3dvcmQocmVzdWx0RS5nZXRQYXNzd29yZCgpLmhhc2gsIHJlc3VsdEUuZ2V0UGFzc3dvcmQoKS5zYWx0LCBwYXNzd29yZCkpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbFNlc3Npb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHV0ZW50ZTogcmVzdWx0RSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2V4dGVybmFsVHV0b3InXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICByZXMuY29va2llKCdsb2dFZmYnLCAnMScpXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKGV4dGVybmFsU2Vzc2lvbilcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmVzLmNvb2tpZSgnZXJyTG9naW4nLCAnMScpXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGhhc2guY2hlY2tQYXNzd29yZChyZXN1bHRBLmdldFBhc3N3b3JkKCkuaGFzaCwgcmVzdWx0QS5nZXRQYXNzd29yZCgpLnNhbHQsIHBhc3N3b3JkKSkge1xuICAgICAgICAgICAgICB2YXIgYWNhZGVtaWNTZXNzaW9uID0ge1xuICAgICAgICAgICAgICAgIHV0ZW50ZTogcmVzdWx0QSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYWNhZGVtaWNUdXRvcidcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXMuY29va2llKCdsb2dFZmYnLCAnMScpXG4gICAgICAgICAgICAgIHJlc29sdmUoYWNhZGVtaWNTZXNzaW9uKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzLmNvb2tpZSgnZXJyTG9naW4nLCAnMScpXG4gICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGhhc2guY2hlY2tQYXNzd29yZChyZXN1bHRTLmdldFBhc3N3b3JkKCkuaGFzaCwgcmVzdWx0Uy5nZXRQYXNzd29yZCgpLnNhbHQsIHBhc3N3b3JkKSkge1xuICAgICAgICAgIHZhciBzdHVkZW50U2Vzc2lvbiA9IHtcbiAgICAgICAgICAgIHV0ZW50ZTogcmVzdWx0UyxcbiAgICAgICAgICAgIHR5cGU6ICdzdHVkZW50J1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXMuY29va2llKCdsb2dFZmYnLCAnMScpXG4gICAgICAgICAgcmVzb2x2ZShzdHVkZW50U2Vzc2lvbilcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuY29va2llKCdlcnJMb2dpbicsICcxJylcbiAgICAgICAgICByZXNvbHZlKGZhbHNlKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSlcbn1cbiJdfQ==